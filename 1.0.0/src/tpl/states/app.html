<div class="container">
  <hr>
  <h1>Welcome to AudibleHero!</h1>

  <div ng-show="data">

    <p>Last update: {{data.updated | date:'medium'}}</p>
    <a class="btn btn-primary" ui-sref="load">Update now</a>

    <div class="row">
      You have <span class="badge">{{(books | where:{owned: true}).length | number:0}}</span> books in your library.
      Of these you have downloaded <span class="badge">{{ (books | where:{downloaded:true}).length | number:0}}</span>.
      That is a total of <span class="badge">{{books | where:{downloaded:true} | map:'duration.asHours()' | _sum | number:0}}</span>
      hours downloaded (and probably
      listened
      to!).
      Found <span class="badge">{{data.books.length | number:0}}</span> books based on your authors.
    </div>
  </div>


  <div class="col-md-12">
    <tabset ng-show="data">
      <tab heading="All books" ng-if="true">
        <div filter-control filter="filter" ng-init="filter.showOwned = true"></div>
        <div booktable books="books" filtered-books="filteredBooks" filter="filter"></div>
      </tab>
      <tab heading="Grouped by series" ng-if="true">
        <div filter-control filter="filter"
             ng-init="filter.showOwned = true; filter.showMissing = true; filter.showSeriesNumber = true; filter.predicate = 'series.number'; filter.fadeOwned = true"></div>
        <label>
          <input type="checkbox" ng-model="showOwnedAndMissing" ng-init="showOwnedAndMissing = true">
          Hide series without any purchased books
        </label>
        <label>
          <input type="checkbox" ng-model="filter.hideDuplicate" ng-init="filter.hideDuplicate = true">
          Hide books with a series number you already own
        </label>

        <div ng-repeat="books in bySeries">
          <div ng-if="books.hasOwnAndMissing || !showOwnedAndMissing" class="col-md-12">
            <div class="panel panel-default" ng-show="filteredBooks.length > 0">
              <div class="panel-heading">
                <h2 class="panel-title">
                  <a ng-href="http://www.audible.com/series/?asin={{key}}">
                    <img ng-src="{{books.key.thumbnailUrl}}">
                    <strong>{{books.key.series.name}}</strong>
                  </a>
                  <button class="btn btn-primary" ng-click="showAll = !showAll">
                    <i class="fa fa-chevron-{{showAll ? 'down' : 'right'}}"></i>
                    See all {{filteredBooks.length}} books
                  </button>
                </h2>
              </div>
              <div class="panel-body">
                <div ng-show="showAll">
                  <div booktable books="books" filtered-books="filteredBooks" filter="filter"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </tab>
      <tab heading="Missing books by Authors" ng-if="true">
        <p>Nothing yet</p>
      </tab>
    </tabset>
  </div>
</div>
